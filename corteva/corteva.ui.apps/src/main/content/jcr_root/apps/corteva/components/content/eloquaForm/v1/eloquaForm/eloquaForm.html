<!--/*
  Copyright 2018,SapientRazorfish_; All Rights Reserved.
 
  This software is the confidential and proprietary information of SapientRazorfish_,
  ("Confidential Information"). You shall not disclose such Confidential Information and shall use it only in
  accordance with the terms of the license agreement you entered into with SapientRazorfish_.
*/-->

<div data-sly-use.comElement="com.corteva.model.component.models.CommonElementsModel" class="feature-flag" data-componentname="${comElement.componentName}" data-featureflagvalue="${comElement.featureFlagState}" data-sly-use.pageMeta="com.corteva.model.component.models.PageMetaModel">

   <sly data-sly-test="${comElement.featureFlagState == 'on'}">
      <!-- success message -->
      <div class="band message-container success-msg hide">
         <sly data-sly-resource="${'formSuccessMessage' @ resourceType='corteva/components/content/richText/v1/richText'}" />
      </div>

      <sly data-sly-test="${wcmmode.edit && !wcmmode.preview}"
           class="aem-helper">Edit Eloqua Form</sly>

      <sly data-sly-test.eloquaLocaleLang="${eloqua.localeForInternationalization}" />
      <sly data-sly-use.eloqua="com.corteva.model.component.models.EloquaFormModel">
         <div class="band ${properties.formBgColor} frm01-form">
            <div class="innerWidth">
               <div class="text">
                  <h2>${properties.title @ context = 'html'}</h2>
                  ${properties.bodyText @ context='html'}
               </div>
               <form method="post" name="${properties.formName}" data-global-siteid="${eloqua.globalSiteId}" data-na-siteid="${eloqua.nASiteId}" data-global-submit-url="${eloqua.globalSubmitUrl}" data-na-submit-url="${eloqua.nASubmitUrl}" data-confirmation-url="${eloqua.confirmationUrl}" action="${eloqua.nASubmitUrl}" id="${properties.formName}" class="elq-form" data-analytics-type="form-data" data-analytics-form-name=${properties.formName} data-analytics-form-id=${properties.formName}>
                  <sly data-sly-test.isForm0="${properties.formName=='AEM_StandardForm_Form0'}" />
                  <sly data-sly-test.isForm1="${properties.formName=='AEM_StandardForm_Form1'}" />
                  <sly data-sly-test.isForm2="${properties.formName=='AEM_StandardForm_Form2'}" />
                  <sly data-sly-test.isForm3="${properties.formName=='AEM_StandardForm_Form3'}" />
                  <div class="api-error form-failure-msg hide">
                     ${properties.errorMsg @ context='html'}
                  </div>
                  <div class="band-content">
                     <sly data-sly-test="${isForm1 || isForm2 || isForm3}">
                        <fieldset>
                           <input id="firstName" maxlength="35" name="firstName" type="text" data-required-msg= "${'eloquaFirstNameErrMsg' @i18n, locale=eloquaLocaleLang }" required data-analytics-type="form-text" data-analytics-value="${'eloquaFirstNameLbl' @i18n, locale=eloquaLocaleLang }"}/>
                           <label for="firstName">${'eloquaFirstNameLbl' @i18n, locale=eloquaLocaleLang }</label>
                           <span class="error"></span>
                        </fieldset>
                     </sly>
                     <sly data-sly-test="${isForm1 || isForm2 || isForm3}">
                        <fieldset>
                           <input id="lastName" maxlength="35" name="lastName" type="text"  data-required-msg= "${'eloquaLastNameErrMsg' @i18n, locale=eloquaLocaleLang }" required data-analytics-type="form-text" data-analytics-value="${'eloquaLastNameLbl' @i18n, locale=eloquaLocaleLang }"/>
                           <label for="lastName">${'eloquaLastNameLbl' @i18n, locale=eloquaLocaleLang }</label>
                           <span class="error"></span>
                        </fieldset>
                     </sly>
                     <fieldset>
                        <input id="emailAddress" maxlength="35" name="emailAddress" type="text"  data-required-msg= "${'eloquaEmailAddErrMsg' @i18n, locale=eloquaLocaleLang }" pattern="${eloqua.emailValidationPattern}" data-pattern-msg="${'eloquaEmailAddPatternMsg' @i18n, locale=eloquaLocaleLang }" required data-analytics-type="form-text" data-analytics-value="${'eloquaEmailAddLbl' @i18n, locale=eloquaLocaleLang }"/>
                        <label for="emailAddress">${'eloquaEmailAddLbl' @i18n, locale=eloquaLocaleLang }</label>
                        <span class="error"></span>
                     </fieldset>
                     <sly data-sly-test="${isForm1 || isForm2 || isForm3}">
                        <fieldset>
                           <select id="role1" name="role1" data-required-msg= "${'eloquaRoleErrMsg' @i18n, locale=eloquaLocaleLang }" required data-analytics-type="form-list" data-analytics-value="${'eloquaRoleLbl' @i18n, locale=eloquaLocaleLang }">
                              <option value=""></option>
                              <sly data-sly-list="${eloqua.rolesList}">
                                 <option value="${item.title}" >
                                    ${item.localizedTitle}
                                 </option>
                              </sly>
                           </select>
                           <label for="role1">${'eloquaRoleLbl' @i18n, locale=eloquaLocaleLang }</label>
                           <span class="error"></span>
                        </fieldset>
                     </sly>
                     <sly data-sly-test="${isForm2 || isForm3}">
                        <fieldset>
                           <input id="company" maxlength="35" name="company" type="text" data-required-msg="${'eloquaCompanyErrMsg' @i18n, locale=eloquaLocaleLang }" required data-analytics-type="form-text" data-analytics-value="${'eloquaCompanyLbl' @i18n, locale=eloquaLocaleLang }"/>
                           <label for="company">${'eloquaCompanyLbl' @i18n, locale=eloquaLocaleLang }</label>
                           <span class="error"></span>
                        </fieldset>
                     </sly>
                     <fieldset>
                        <select id="country" name="country" data-required-msg="${'eloquaCountryErrMsg' @i18n, locale=eloquaLocaleLang }" data-statemapping="${eloqua.countryStatesListJson}" required data-analytics-type="form-list" data-analytics-value="${'eloquaCountryLbl' @i18n, locale=eloquaLocaleLang }">
                           <option value="" selected></option>
                           <sly data-sly-list="${eloqua.countriesList}">
                              <option value="${item.title}" data-country-code = "${item.value}">
                                 ${item.localizedTitle}
                              </option>
                           </sly>
                        </select>
                        <label for="country">${'eloquaCountryLbl' @i18n, locale=eloquaLocaleLang }</label>
                        <span class="error"></span>
                     </fieldset>
                     <sly data-sly-test="${isForm2 || isForm3}">
                        <fieldset>
                           <input id="address1" maxlength="35" name="address1" type="text" data-required-msg="${'eloquaAddressErrMsg' @i18n, locale=eloquaLocaleLang }" required data-analytics-type="form-text" data-analytics-value="${'eloquaAddressLbl' @i18n, locale=eloquaLocaleLang }"/>
                           <label for="address1">${'eloquaAddressLbl' @i18n, locale=eloquaLocaleLang }</label>
                           <span class="error"></span>
                        </fieldset>
                     </sly>
                  </sly>
                  <fieldset>
                        <input id="zipPostal" name="zipPostal" type="text" data-required-msg="${'eloquaZipErrMsg' @i18n, locale=eloquaLocaleLang }" required data-apierror = "${'eloquaValidZipErrMsg' @i18n, locale=eloquaLocaleLang }" data-api-url="${eloqua.zipValidationAPIUrl}" data-analytics-type="form-text" data-analytics-value="${'eloquaZipLbl' @i18n, locale=eloquaLocaleLang }" data-pattern="^[ABCEGHJKLMNPRSTVXY]{1}\d{1}[A-Z]{1} *\d{1}[A-Z]{1}\d{1}$" data-patternus="^\d{5}$"/>
                        <label for="zipPostal">${'eloquaZipLbl' @i18n, locale=eloquaLocaleLang }</label>
                        <span class="error"></span>
                  </fieldset>
                     <sly data-sly-test="${isForm3}">
                        <fieldset class="half-width">
                           <input id="city" maxlength="35" name="city" type="text" data-required-msg="${'eloquaCityErrMsg' @i18n, locale=eloquaLocaleLang }" required data-analytics-type="form-text" data-analytics-value="${'eloquaCityLbl' @i18n, locale=eloquaLocaleLang }"/>
                           <label for="city">${'eloquaCityLbl' @i18n, locale=eloquaLocaleLang }</label>
                           <span class="error"></span>
                        </fieldset>
                     </sly>
                     <sly data-sly-test="${isForm3}">
                        <fieldset>
                           <select id="stateProv" name="stateProv" data-required-msg="${'eloquaStateErrMsg' @i18n, locale=eloquaLocaleLang }" required data-analytics-type="form-list" data-analytics-value="${'eloquaStateLbl' @i18n, locale=eloquaLocaleLang }">
                              <option value="" selected></option>
                           </select>
                           <label for="stateProv">${'eloquaStateLbl' @i18n, locale=eloquaLocaleLang }</label>
                           <span class="error"></span>
                        </fieldset>
                     </sly>
                     <sly data-sly-test="${isForm2 || isForm3}">
                        <fieldset class="third-width">
                           <select id="countryCode" name="countryCode" data-required-msg="${'eloquaCountryCodeErrMsg' @i18n, locale=eloquaLocaleLang }" required data-analytics-type="form-list" data-analytics-value="${'eloquaCountryCodeLbl' @i18n, locale=eloquaLocaleLang }">
                              <option value="" selected></option>
                              <sly data-sly-list="${eloqua.countryCodes}">
                                 <sly data-sly-test="${item}">
                                    <option value="${item}" >
                                       ${item}
                                    </option>
                                 </sly>
                              </sly>
                           </select>
                           <label for="countryCode">${'eloquaCountryCodeLbl' @i18n, locale=eloquaLocaleLang }</label>
                           <span class="error"></span>
                        </fieldset>
                     </sly>
                     <sly data-sly-test="${isForm2 || isForm3}">
                        <fieldset>
                           <input id="mobilePhone" maxlength="35" name="mobilePhone" type="text" data-required-msg="${'eloquaMobileErrMsg' @i18n, locale=eloquaLocaleLang }" data-pattern-msg="${'eloquaMobilePatternErrMsg' @i18n, locale=eloquaLocaleLang }" required data-pattern="${eloqua.mobileValidationPattern}" data-analytics-type="form-text" data-analytics-value="${'eloquaMobileLbl' @i18n, locale=eloquaLocaleLang }"/>
                           <label for="mobilePhone">${'eloquaMobileLbl' @i18n, locale=eloquaLocaleLang }</label>
                           <span class="error"></span>
                        </fieldset>
                     </sly>
      </sly>
      <sly data-sly-test="${properties.optinLbl}">
         <fieldset>
            <input type="checkbox" id="optIn1" name="optIn1" value="on" role="checkbox" data-analytics-type="form-checkbox" data-analytics-value="communications opt in">
            <label for="optIn1">${properties.optinLbl}</label>
            <span class="error"></span>
         </fieldset>
      </sly>
      <fieldset>
         <div class="g-recaptcha" data-sitekey="${eloqua.googleCaptchaSiteKey}" data-language="${pageMeta.language}" data-callback ="captchaSubmitCallback" data-required-msg="${'eloquaCaptchaErrMsg' @i18n, locale=eloquaLocaleLang }"></div>
         <span class="error"></span>
      </fieldset>
      <button type="submit" class="c-button c-button--submit" data-analytics-type="form-submit">
         ${properties.submitBtnLbl}
      </button>

      <div class="disclaimer">
         ${properties.complianceText @ context='html'}
      </div>
      <input value="${properties.formName}" type="hidden" name="elqFormName"  />
      <input value="${siteId}" type="hidden" name="elqSiteId"  />
      <input id="field12" type="hidden" name="originName1" value="${eloqua.originName}" />
      <input id="field13" type="hidden" name="originForm1" value="${eloqua.currentPagePath}"  />
      <input id="field14" type="hidden" name="originURL1" value=""  />
      <input id="field15" type="hidden" name="originTrackingCode1" value=""  />   
      <input id="field16" type="hidden" name="utm_source" value="Direct"  />   
      <input id="field17" type="hidden" name="utm_medium" value="Direct"  />  
      <input id="field18" type="hidden" name="optinname" value="${properties.formType}" />    
      <input id="field19" type="hidden" name="adobe_mcid" value=""  />   
      <input id="field20" type="hidden" name="elqCookieWrite" value="0"  />
      <input id="field22" type="hidden" name="originPageName1" value="${currentPage.pageTitle}" />
      <input type="hidden" name="elqCustomerGUID" value="" data-analytics-form-guid ="">
      <input type="hidden" name="elqCampaignId" value="" data-author-val="${properties.campaignId}">
</div>
</form>
</div>
</div>
</sly>

<script type="text/javascript" >
      var _elqQ = _elqQ || [],
      	formName = document.getElementsByName('elqFormName'),
          formElm = document.forms[formName[0].defaultValue];
      
      _elqQ.push(['elqSetSiteId', formElm.getAttribute('data-na-siteid')]);
      _elqQ.push(['elqTrackPageView']);
      
      (function () {
	      function async_load() {
	      	var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true;
	      	s.src = 'https://img.en25.com/i/elqCfg.min.js';
	      	var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);
	      }
	      if (window.addEventListener) window.addEventListener('DOMContentLoaded', async_load, false);
	      else if (window.attachEvent) window.attachEvent('onload', async_load);
	  })();

      var timerId = null, timeout = 5;

      function WaitUntilCustomerGUIDIsRetrieved() {

	      if (!!(timerId)) {
	      if (timeout == 0) {
	      return;
	      }
	      
	      if (typeof this.GetElqCustomerGUID === 'function') {
	      	formElm.elements["elqCustomerGUID"].value = GetElqCustomerGUID();
	      	formElm.elements["elqCustomerGUID"].setAttribute('data-analytics-form-guid', GetElqCustomerGUID());
	      	return;
	      }
	      timeout -= 1;
	      }
	      
	      timerId = setTimeout("WaitUntilCustomerGUIDIsRetrieved()", 500);
	      return;
      }
      window.onload = WaitUntilCustomerGUIDIsRetrieved;
      
      _elqQ.push(['elqGetCustomerGUID']);
      

      function captchaSubmitCallback() {
         return new Promise(function(resolve, reject) {  
         let $captcha = $('form.elq-form').find('.g-recaptcha'),
        $errField = $captcha.siblings('.error');

    if (typeof grecaptcha !== 'undefined' && grecaptcha.getResponse() === '') {
      $captcha.addClass('invalid');
      if ($errField.html() === '') {
        $errField.html($captcha.data('required-msg'));
      }
      $errField.show();
      reject();
    } else if (grecaptcha.getResponse() !== '') {
      $('#g-recaptcha-response').val(grecaptcha.getResponse())
      resolve(); 
    } else {
      console.log('captcha error');
      reject();
    }
      });
   }
   </script>
</sly>
</div>
